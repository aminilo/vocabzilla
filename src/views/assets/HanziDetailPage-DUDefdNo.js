var X=Object.defineProperty;var B=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var E=(l,a,s)=>a in l?X(l,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[a]=s,D=(l,a)=>{for(var s in a||(a={}))j.call(a,s)&&E(l,s,a[s]);if(B)for(var s of B(a))J.call(a,s)&&E(l,s,a[s]);return l};var F=(l,a,s)=>new Promise((f,p)=>{var b=n=>{try{m(s.next(n))}catch(u){p(u)}},C=n=>{try{m(s.throw(n))}catch(u){p(u)}},m=n=>n.done?f(n.value):Promise.resolve(n.value).then(b,C);m((s=s.apply(l,a)).next())});import{a as K,c as W,u as O,r as g,v as A,o as Q,b as Y,e as d,g as i,l as S,p as T,m as k,L as Z,t as x,k as U,F as ee,G as te,q as w,i as se,h as ae,I as oe,J as ne,f as c}from"./vue-vendors-BgzxvA44.js";import{u as ie,s as h,a as le,_ as re}from"./index-D7M0O3Y9.js";import{u as de,a as ce}from"./useParty-ClvTV5g0.js";import"./socket-CF4wHI2V.js";import"./anime-DaNXu8ZO.js";const ue={class:"min-h-screen bg py-20 px-2"},pe={class:"min-w-xl max-w-6xl mx-auto space-y-10"},me={class:"goBackLink"},ve={key:0,class:"text-center text-xl"},ge={key:1},xe={class:"bg shadow-xl rounded-2xl p-4 text-center"},he={class:"text-3xl md:text-5xl xl:text-6xl font-bold mb-4"},fe={class:"text-xl mb-2"},_e={class:"text-xl"},ye={class:"mt-8"},ke={key:0,class:"flex items-center flex-col italic space-y-1 text-lg"},we=["data-cihui-id"],be={class:"text-xl lg:text-2xl xl:text-3xl text-center"},Ce={class:"text-sm 2xl:text-base text-gray-700 dark:text-gray-200 mb-2"},Le=["onUpdate:modelValue"],ze={key:2,class:"text-gray-500 italic mt-4"},Pe={key:2,class:"paramNotFound"},Me=K({__name:"HanziDetailPage",setup(l){const{triggerEffect:a}=de(),s=new Set,f=ie(),p=W(()=>{var e;return(e=f.user)==null?void 0:e.id}),b=O(),C=se(),m=b.params.zi,n=g(null),u=g([]),L=g(!0),_=g({}),M=g({}),N=g(null),R=g(!1),H=/Mobi|Android/i.test(navigator.userAgent),I=e=>e.includes("/")?e.split("/").map(t=>t.trim()):[e.trim()],V=e=>{e.key==="Backspace"&&!(e.target instanceof HTMLInputElement)&&(e.preventDefault(),C.push("/ch/hanzi"))},q=()=>F(null,null,function*(){L.value=!0;try{const{data:e}=yield le.get(`/ch/hanzi/${m}`);n.value=e.hanziRecord,u.value=e.cihuiRecord,_.value={},requestAnimationFrame(()=>{ce(N.value,".cihui-line")})}catch(e){console.error("❌ Failed to fetch hanzi details:",e)}finally{L.value=!1}});return A(()=>D({},_.value),(e,t)=>{var v,o,y;if(!(!p.value||!u.value.length))for(const r of u.value){const z=(v=e[r.id])==null?void 0:v.trim(),G=(o=t==null?void 0:t[r.id])==null?void 0:o.trim();if(z&&z!==G&&z===r.ch&&!s.has(r.id)){s.add(r.id);const P=(((y=M.value[r.id])==null?void 0:y.correctCount)||0)+1,$=P>=3?"mastered":"learning";M.value[r.id]={correctCount:P,status:$},h.emit("word:practiced",{userId:p.value,itemType:"cihui",itemId:r.id,status:$,correctCount:P,xpGain:5})}}},{deep:!0}),A(()=>[f.profileLoaded,p.value],([e,t])=>{(e||!f.isAuthenticated)&&!R.value&&(q(),R.value=!0)},{immediate:!0}),Q(()=>{window.addEventListener("keydown",V),h.on("xp:updated",({xpGain:e,currentXp:t,currentLevel:v,lang:o})=>{console.log(`+${e} XP | New ${o.toUpperCase()} XP: ${t}, Level: ${v}`)}),h.on("level:up",({newLevel:e,lang:t})=>{console.log(`🎉 Level up in ${t==="ch"?"Chinese":"English"}! Now level ${e}`),a()}),h.on("progress:saved",({itemId:e,itemType:t,status:v})=>{})}),Y(()=>{window.removeEventListener("keydown",V),h.off("xp:updated"),h.off("level:up"),h.off("progress:saved")}),(e,t)=>{const v=Z("router-link");return c(),d("div",ue,[i("main",pe,[i("div",me,[S(v,{title:k(H)?"":"Press Backspace to go back to Character List",to:"/ch/hanzi"},{default:T(()=>t[0]||(t[0]=[w(" ← Back to Character List ")])),_:1},8,["title"])]),L.value?(c(),d("div",ve,"Loading...")):n.value?(c(),d("div",ge,[i("div",xe,[i("h1",he,x(k(m)),1),i("p",fe,"Pinyin: "+x(n.value.pinyin||"—"),1),i("p",_e,"Meaning: "+x(n.value.meaning||"—"),1)]),i("div",ye,[p.value?U("",!0):(c(),d("div",ke,[t[2]||(t[2]=i("p",null,"Wanna make it a bit more interactive?",-1)),S(v,{to:`/login?redirect=${k(b).fullPath}`,class:"text-blue-500 font-bold p-2 hover:underline"},{default:T(()=>t[1]||(t[1]=[w(" Log in to start, shall we ")])),_:1},8,["to"])])),u.value.length>0?(c(),d("div",{key:1,ref_key:"cihuiRef",ref:N,class:"mt-2 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"},[(c(!0),d(ee,null,te(u.value,o=>{var y;return c(),d("div",{key:o.id,class:ae(["cihui-line",{"font-extrabold ring-4":((y=_.value[o.id])==null?void 0:y.trim())===o.ch}]),"data-cihui-id":o.id},[i("p",be,x(o.ch),1),i("div",Ce,[t[3]||(t[3]=i("span",{class:"font-semibold"},"English:",-1)),w(" "+x(I(o.en).join(", ")),1)]),p.value?oe((c(),d("input",{key:0,autofocus:"","onUpdate:modelValue":r=>_.value[o.id]=r,type:"text",class:"w-full text-center bg-gradient-light dark:bg-gradient-dark outline-none ring-1 focus:ring-4 rounded-md px-2 py-1",placeholder:"????"},null,8,Le)),[[ne,_.value[o.id]]]):U("",!0)],10,we)}),128))],512)):(c(),d("div",ze,'No words found containing "'+x(k(m))+'".',1))])])):(c(),d("div",Pe,[t[4]||(t[4]=w(" Character ")),i("span",null,'" '+x(k(m))+' "',1),t[5]||(t[5]=w(" not found. "))]))])])}}}),Fe=re(Me,[["__scopeId","data-v-dfcde3ee"]]);export{Fe as default};
